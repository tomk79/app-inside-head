{"version":3,"file":"dialogue/index_files/script.js","mappings":"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","sources":["webpack:///./dialogue/index_files/src.ignore/includes/Member.js","webpack:///./dialogue/index_files/src.ignore/includes/Committee.js","webpack:///./dialogue/index_files/src.ignore/script.js"],"sourcesContent":["class Member {\n\t#template = '';\n\n\tconstructor(options) {\n\t\tthis.#template = options.template || '';\n\t}\n\n\task (params) {\n\t\tconst message = this.#bindTemplate(params);\n\n\t\treturn new Promise((resolve, reject)=>{\n\t\t\t$.ajax({\n\t\t\t\t'url': './index_files/apis/query.php',\n\t\t\t\t\"type\": \"post\",\n\t\t\t\t\"dataType\": \"json\",\n\t\t\t\t\"contentType\": \"application/json\",\n\t\t\t\t\"data\": JSON.stringify({\n\t\t\t\t\t\"messages\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"role\": \"user\",\n\t\t\t\t\t\t\t\"content\": message,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\t\"headers\": {\n\t\t\t\t\t\"X-CSRF-TOKEN\": $('meta[name=csrf-token]').attr('content'),\n\t\t\t\t},\n\t\t\t\t\"async\": true,\n\t\t\t}).done((result)=>{\n\t\t\t\tresolve(result);\n\t\t\t}).fail((err)=>{\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\t#bindTemplate (contents) {\n\t\tlet template = this.#template;\n\t\tif(!template){\n\t\t\ttemplate = '${mainTheme}';\n\t\t}\n\t\ttemplate = template.split('${mainTheme}').join(contents.mainTheme);\n\t\treturn template;\n\t}\n}\nexport default Member;\n","import Member from \"./Member\";\n\nclass Committee {\n\t#status = 'stop';\n\t#mainTheme;\n\t#currentIdea;\n\t#turnNumber = 0;\n\t#talkLog = [];\n\n\t#callback_onmessage;\n\t#callback_onstop;\n\n\t#members;\n\n\t/**\n\t * Constructor\n\t */\n\tconstructor() {\n\t}\n\n\t/**\n\t * 初期化する\n\t */\n\tinit (params) {\n\t\tthis.#status = 'stop';\n\t\tthis.#mainTheme = params.mainTheme;\n\t\tthis.#currentIdea = '';\n\t\tthis.#turnNumber = 0;\n\t\tthis.#talkLog = [];\n\n\t\tthis.#callback_onmessage = params.onmessage || function(){};\n\t\tthis.#callback_onstop = params.onstop || function(){};\n\n\t\tthis.#members = {\n\t\t\tpresenter: new Member({\n\t\t\t\ttemplate: params.members.presenter.template || '',\n\t\t\t}),\n\t\t\treviewers: [],\n\t\t};\n\t\tparams.members.reviewers.forEach((member)=>{\n\t\t\tthis.#members.reviewers.push(new Member({\n\t\t\t\ttemplate: member.template || '',\n\t\t\t}));\n\t\t});\n\t}\n\n\t/**\n\t * ディスカッションを開始する\n\t */\n\tstartDiscussion () {\n\t\tthis.#status = 'playing';\n\t\tthis.#idation();\n\t}\n\n\t/**\n\t * アイデアを提案する\n\t */\n\t#idation () {\n\t\tthis.#turnNumber ++;\n\t\tif( this.#turnNumber > 10 || this.#status == 'stop' ){\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#members.presenter.ask({\n\t\t\tmainTheme: this.#mainTheme,\n\t\t})\n\t\t\t.then((result)=>{\n\t\t\t\tthis.#currentIdea = result.choices[0].message.content;\n\t\t\t\tthis.#callback_onmessage({\n\t\t\t\t\tphase: 'idation',\n\t\t\t\t\tcurrentIdea: this.#currentIdea,\n\t\t\t\t});\n\t\t\t\tthis.#review();\n\t\t\t}).catch((err)=>{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\treturn;\n\t}\n\n\t/**\n\t * アイデアをレビューする\n\t */\n\t#review () {\n\t\tlet reviewers = [];\n\t\tthis.#members.reviewers.forEach((reviewer)=>{\n\t\t\treviewers.push(reviewer.ask({\n\t\t\t\tmainTheme: this.#mainTheme,\n\t\t\t\tcurrentIdea: this.#currentIdea,\n\t\t\t}));\n\t\t});\n\t\treturn Promise.allSettled(reviewers)\n\t\t\t.then((result)=>{\n\t\t\t\tthis.#callback_onmessage({\n\t\t\t\t\tphase: 'review',\n\t\t\t\t\treviews: result,\n\t\t\t\t});\n\n\t\t\t\tconst score = this.#scoreingReviews(result);\n\t\t\t\tif( score.total <= score.agree ){\n\t\t\t\t\tthis.stopDiscussion();\n\t\t\t\t}else{\n\t\t\t\t\tthis.#idation();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err)=>{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t}\n\n\t/**\n\t * レビューを評価する\n\t */\n\t#scoreingReviews (reviews) {\n\t\tconst scores = [];\n\t\tconst counter = {\n\t\t\t\"agree\": 0, // 賛成\n\t\t\t\"opposition\": 0, // 反対\n\t\t\t\"unknown\": 0,\n\t\t\t\"total\": 0,\n\t\t};\n\t\treviews.forEach((review, index)=>{\n\t\t\tconst message = review.value.choices[0].message;\n\t\t\tmessage.content.match(/^[\\s\\S]*?(賛成|反対)/);\n\t\t\tconst matched = RegExp.$1;\n\t\t\tcounter.total ++;\n\t\t\tif( matched=='賛成' ){\n\t\t\t\tcounter.agree ++;\n\t\t\t\tscores.push(true);\n\t\t\t}else if( matched=='反対' ){\n\t\t\t\tcounter.opposition ++;\n\t\t\t\tscores.push(false);\n\t\t\t}else{\n\t\t\t\tcounter.unknown ++;\n\t\t\t\tscores.push(null);\n\t\t\t}\n\t\t});\n\t\treturn counter;\n\t}\n\n\t/**\n\t * ディスカッションを中止する\n\t */\n\tstopDiscussion () {\n\t\tthis.#status = 'stop';\n\t\tthis.#callback_onstop();\n\t}\n}\nexport default Committee;\n","import Committee from \"./includes/Committee\";\n\nconst committee = new Committee();\nlet csrfToken;\n\nconst $discussionLog = $('#cont-discussion-log');\nconst $btnStart = $('#cont-btn-start');\nconst $btnStop = $('#cont-btn-stop');\n$btnStop.attr({'disabled': true});\n\n$btnStart.on('click', ()=>{\n\t$btnStart.attr({'disabled': true});\n\t$btnStop.attr({'disabled': false});\n\tconst inputMainTheme = $('textarea[name=\"main-theme\"]').val();\n\n\tnew Promise((resolve, reject)=>{\n\t\tif(csrfToken){\n\t\t\tresolve(csrfToken);\n\t\t\treturn;\n\t\t}\n\t\twindow.getCsrfToken((result)=>{\n\t\t\tcsrfToken = result;\n\t\t\tresolve(csrfToken);\n\t\t\treturn;\n\t\t});\n\t}).then((csrfToken)=>{\n\t\treturn new Promise((resolve, reject)=>{\n\t\t\t$.ajax({\n\t\t\t\t'url': './index_files/apis/get_committee_settings.php',\n\t\t\t\t\"type\": \"get\",\n\t\t\t\t\"dataType\": \"json\",\n\t\t\t\t\"async\": true,\n\t\t\t}).done((result)=>{\n\t\t\t\tresolve(result.members);\n\t\t\t}).fail((err)=>{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\t});\n\n\t}).then((committeeInfo)=>{\n\t\t$discussionLog.html('');\n\t\tcommittee.init({\n\t\t\tmainTheme: inputMainTheme,\n\t\t\tmembers: committeeInfo,\n\t\t\tonmessage: (message)=>{\n\t\t\t\tconsole.log('=-=-=-=-= message:', message);\n\t\t\t},\n\t\t\tonstop: ()=>{\n\t\t\t\t$btnStart.attr({'disabled': false});\n\t\t\t\t$btnStop.attr({'disabled': true});\n\t\t\t},\n\t\t});\n\t\tcommittee.startDiscussion();\n\t});\n});\n\n$btnStop.on('click', ()=>{\n\tcommittee.stopDiscussion();\n});\n"],"names":["_bindTemplate","contents","template","this","_template","split","join","mainTheme","Member","options","_classCallCheck","_Member_brand","_classPrivateFieldInitSpec","key","value","params","message","_assertClassBrand","call","Promise","resolve","reject","$","ajax","JSON","stringify","attr","done","result","fail","err","_status","WeakMap","_mainTheme","_currentIdea","_turnNumber","_talkLog","_callback_onmessage","_callback_onstop","_members","_Committee_brand","WeakSet","_idation","_this$turnNumber","_this2","_classPrivateFieldSet","_classPrivateFieldGet","presenter","ask","then","choices","content","phase","currentIdea","_review","console","error","_this3","reviewers","forEach","reviewer","push","allSettled","reviews","score","_scoreingReviews","total","agree","stopDiscussion","scores","counter","review","index","match","matched","RegExp","$1","opposition","unknown","csrfToken","committee","Committee","_this","onmessage","onstop","members","member","$discussionLog","$btnStart","$btnStop","on","inputMainTheme","val","window","getCsrfToken","committeeInfo","html","init","log","startDiscussion"],"sourceRoot":""}