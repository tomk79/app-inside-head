{"version":3,"file":"dialogue/index_files/script.js","mappings":"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","sources":["webpack:///./dialogue/index_files/src.ignore/includes/Member.js","webpack:///./dialogue/index_files/src.ignore/includes/Committee.js","webpack:///./dialogue/index_files/src.ignore/script.js"],"sourcesContent":["class Member {\n\t#template = '';\n\n\t/**\n\t * Constructor\n\t */\n\tconstructor(options) {\n\t\tthis.#template = options.template || '';\n\t}\n\n\t/**\n\t * 質問を送信する\n\t * @param {*} params \n\t * @returns \n\t */\n\task (params) {\n\n\t\treturn new Promise((resolve, reject)=>{\n\t\t\t$.ajax({\n\t\t\t\t'url': './index_files/apis/query.php',\n\t\t\t\t\"type\": \"post\",\n\t\t\t\t\"dataType\": \"json\",\n\t\t\t\t\"contentType\": \"application/json\",\n\t\t\t\t\"data\": JSON.stringify({\n\t\t\t\t\t\"messages\": params,\n\t\t\t\t}),\n\t\t\t\t\"headers\": {\n\t\t\t\t\t\"X-CSRF-TOKEN\": $('meta[name=csrf-token]').attr('content'),\n\t\t\t\t},\n\t\t\t\t\"async\": true,\n\t\t\t}).done((result)=>{\n\t\t\t\tresolve(result);\n\t\t\t}).fail((err)=>{\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * テンプレートに値をバインドする\n\t */\n\tbindTemplate (contents) {\n\t\tlet template = this.#template;\n\t\tif(!template){\n\t\t\ttemplate = '${mainTheme}';\n\t\t}\n\t\ttemplate = template.split('${mainTheme}').join(contents.mainTheme);\n\t\ttemplate = template.split('${currentIdea}').join(contents.currentIdea);\n\t\treturn template;\n\t}\n}\nexport default Member;\n","import Member from \"./Member\";\n\nclass Committee {\n\t#status = 'stop';\n\t#mainTheme;\n\t#currentIdea;\n\t#turnNumber = 0;\n\t#idationMessageLog = [];\n\n\t#callback_onmessage;\n\t#callback_onstop;\n\n\t#members;\n\n\t/**\n\t * Constructor\n\t */\n\tconstructor() {\n\t}\n\n\t/**\n\t * 初期化する\n\t */\n\tinit (params) {\n\t\tthis.#status = 'stop';\n\t\tthis.#mainTheme = params.mainTheme;\n\t\tthis.#currentIdea = '';\n\t\tthis.#turnNumber = 0;\n\t\tthis.#idationMessageLog = [];\n\n\t\tthis.#callback_onmessage = params.onmessage || function(){};\n\t\tthis.#callback_onstop = params.onstop || function(){};\n\n\t\tthis.#members = {\n\t\t\tpresenter: new Member({\n\t\t\t\ttemplate: params.members.presenter.template || '',\n\t\t\t}),\n\t\t\treviewers: [],\n\t\t};\n\t\tparams.members.reviewers.forEach((member)=>{\n\t\t\tthis.#members.reviewers.push(new Member({\n\t\t\t\ttemplate: member.template || '',\n\t\t\t}));\n\t\t});\n\t}\n\n\t/**\n\t * ディスカッションを開始する\n\t */\n\tstartDiscussion () {\n\t\tthis.#status = 'playing';\n\t\tthis.#idation();\n\t}\n\n\t/**\n\t * アイデアを提案する\n\t */\n\t#idation () {\n\t\tthis.#turnNumber ++;\n\t\tif( this.#turnNumber > 10 || this.#status == 'stop' ){\n\t\t\treturn;\n\t\t}\n\n\t\tif(!this.#idationMessageLog.length){\n\t\t\tthis.#idationMessageLog.push({\n\t\t\t\trole: \"user\",\n\t\t\t\tcontent: this.#members.presenter.bindTemplate({\n\t\t\t\t\tmainTheme: this.#mainTheme,\n\t\t\t\t}),\n\t\t\t});\n\t\t}\n\n\t\tthis.#members.presenter.ask(this.#idationMessageLog)\n\t\t\t.then((result)=>{\n\t\t\t\tthis.#idationMessageLog.push(result.choices[0].message);\n\t\t\t\tthis.#currentIdea = result.choices[0].message.content;\n\t\t\t\tthis.#callback_onmessage({\n\t\t\t\t\tphase: 'idation',\n\t\t\t\t\tcurrentIdea: this.#currentIdea,\n\t\t\t\t});\n\t\t\t\tthis.#review();\n\t\t\t}).catch((err)=>{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\treturn;\n\t}\n\n\t/**\n\t * アイデアをレビューする\n\t */\n\t#review () {\n\t\tlet reviewers = [];\n\t\tthis.#members.reviewers.forEach((reviewer)=>{\n\t\t\tconst reviewMessage = [{\n\t\t\t\trole: \"user\",\n\t\t\t\tcontent: reviewer.bindTemplate({\n\t\t\t\t\tmainTheme: this.#mainTheme,\n\t\t\t\t\tcurrentIdea: this.#currentIdea,\n\t\t\t\t}),\n\t\t\t}];\n\n\t\t\treviewers.push(reviewer.ask(reviewMessage));\n\t\t});\n\n\t\treturn Promise.allSettled(reviewers)\n\t\t\t.then((result)=>{\n\t\t\t\tconst score = this.#scoreingReviews(result);\n\n\t\t\t\tlet messages = [];\n\t\t\t\tresult.forEach((review, index)=>{\n\t\t\t\t\tconst message = review.value.choices[0].message;\n\t\t\t\t\tmessage.stance = score.scores[index];\n\t\t\t\t\tmessages.push(message);\n\t\t\t\t});\n\t\t\t\tthis.#callback_onmessage({\n\t\t\t\t\tphase: 'review',\n\t\t\t\t\treviews: messages,\n\t\t\t\t});\n\n\t\t\t\tif( score.total <= score.agree ){\n\t\t\t\t\tthis.stopDiscussion();\n\t\t\t\t}else{\n\t\t\t\t\tthis.#idationMessageLog.push({\n\t\t\t\t\t\trole: \"user\",\n\t\t\t\t\t\tcontent: `可決しませんでした。修正案を提案してください。`, // TODO: 修正案生成のプロンプトを作成する\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#idation();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err)=>{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t}\n\n\t/**\n\t * レビューを評価する\n\t */\n\t#scoreingReviews (reviews) {\n\t\tconst counter = {\n\t\t\t\"agree\": 0, // 賛成\n\t\t\t\"opposition\": 0, // 反対\n\t\t\t\"unknown\": 0,\n\t\t\t\"total\": 0,\n\t\t\t\"scores\": [],\n\t\t};\n\t\treviews.forEach((review, index)=>{\n\t\t\tconst message = review.value.choices[0].message;\n\t\t\tmessage.content.match(/^[\\s\\S]*?(賛成|反対)/);\n\t\t\tconst matched = RegExp.$1;\n\t\t\tcounter.total ++;\n\t\t\tif( matched=='賛成' ){\n\t\t\t\tcounter.agree ++;\n\t\t\t\tcounter.scores.push(true);\n\t\t\t}else if( matched=='反対' ){\n\t\t\t\tcounter.opposition ++;\n\t\t\t\tcounter.scores.push(false);\n\t\t\t}else{\n\t\t\t\tcounter.unknown ++;\n\t\t\t\tcounter.scores.push(null);\n\t\t\t}\n\t\t});\n\t\treturn counter;\n\t}\n\n\t/**\n\t * ディスカッションを中止する\n\t */\n\tstopDiscussion () {\n\t\tthis.#status = 'stop';\n\t\tthis.#callback_onstop();\n\t}\n}\nexport default Committee;\n","import Committee from \"./includes/Committee\";\n\nconst committee = new Committee();\nlet csrfToken;\n\nconst $discussionLog = $('#cont-discussion-log');\nconst $btnStart = $('#cont-btn-start');\nconst $btnStop = $('#cont-btn-stop');\n$btnStop.attr({'disabled': true});\n\n$btnStart.on('click', ()=>{\n\t$btnStart.attr({'disabled': true});\n\t$btnStop.attr({'disabled': false});\n\tconst inputMainTheme = $('textarea[name=\"main-theme\"]').val();\n\n\tnew Promise((resolve, reject)=>{\n\t\tif(csrfToken){\n\t\t\tresolve(csrfToken);\n\t\t\treturn;\n\t\t}\n\t\twindow.getCsrfToken((result)=>{\n\t\t\tcsrfToken = result;\n\t\t\tresolve(csrfToken);\n\t\t\treturn;\n\t\t});\n\t}).then((csrfToken)=>{\n\t\treturn new Promise((resolve, reject)=>{\n\t\t\t$.ajax({\n\t\t\t\t'url': './index_files/apis/get_committee_settings.php',\n\t\t\t\t\"type\": \"get\",\n\t\t\t\t\"dataType\": \"json\",\n\t\t\t\t\"async\": true,\n\t\t\t}).done((result)=>{\n\t\t\t\tresolve(result.members);\n\t\t\t}).fail((err)=>{\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\t});\n\n\t}).then((committeeInfo)=>{\n\t\t$discussionLog.html('');\n\t\tcommittee.init({\n\t\t\tmainTheme: inputMainTheme,\n\t\t\tmembers: committeeInfo,\n\t\t\tonmessage: (message)=>{\n\t\t\t\tconsole.log('=-=-=-=-= message:', message);\n\t\t\t\t$discussionLog.append(`<p>${JSON.stringify(message)}</p>`);\n\t\t\t},\n\t\t\tonstop: ()=>{\n\t\t\t\t$btnStart.attr({'disabled': false});\n\t\t\t\t$btnStop.attr({'disabled': true});\n\t\t\t},\n\t\t});\n\t\tcommittee.startDiscussion();\n\t});\n});\n\n$btnStop.on('click', ()=>{\n\tcommittee.stopDiscussion();\n});\n"],"names":["Member","options","_classCallCheck","_template","template","this","key","value","params","Promise","resolve","reject","$","ajax","JSON","stringify","attr","done","result","fail","err","contents","split","join","mainTheme","currentIdea","_status","WeakMap","_mainTheme","_currentIdea","_turnNumber","_idationMessageLog","_callback_onmessage","_callback_onstop","_members","_Committee_brand","WeakSet","_idation","_this$turnNumber","_this2","_classPrivateFieldSet","_classPrivateFieldGet","length","push","role","content","presenter","bindTemplate","ask","then","choices","message","call","phase","_assertClassBrand","_review","console","error","_this3","reviewers","forEach","reviewer","reviewMessage","allSettled","score","_scoreingReviews","messages","review","index","stance","scores","reviews","total","agree","stopDiscussion","counter","match","matched","RegExp","$1","opposition","unknown","csrfToken","committee","Committee","_classPrivateFieldInitSpec","_this","onmessage","onstop","members","member","$discussionLog","$btnStart","$btnStop","on","inputMainTheme","val","window","getCsrfToken","committeeInfo","html","init","log","append","concat","startDiscussion"],"sourceRoot":""}