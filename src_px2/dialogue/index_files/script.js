(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function n(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,"string");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function o(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var r=new WeakMap,a=new WeakSet;function s(e){var t,n=(this,(t=r).get(i(t,this)));return n||(n="${mainTheme}"),n.split("${mainTheme}").join(e.mainTheme)}const c=function(){return e=function e(t){var n,s,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,n=a),n.add(this),function(e,t,n){o(e,t),t.set(e,"")}(this,r),s=r,c=t.template||"",s.set(i(s,this),c)},(n=[{key:"ask",value:function(e){var t=i(a,this,s).call(this,e);return new Promise((function(e,n){$.ajax({url:"./index_files/apis/query.php",type:"post",dataType:"json",data:{content:t,CSRF_TOKEN:$("meta[name=csrf-token]").attr("content")},async:!0}).done((function(t){e(t)})).fail((function(e){n(e)}))}))}}])&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,l(o.key),o)}}function l(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=u(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}function h(e,t,n){p(e,t),t.set(e,n)}function p(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function m(e,t){return e.get(v(e,t))}function y(e,t,n){return e.set(v(e,t),n),n}function v(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var b=new WeakMap,w=new WeakMap,g=new WeakMap,d=new WeakMap,k=new WeakMap,S=new WeakSet;function T(){var e,t=this;y(g,this,(e=m(g,this),++e)),m(g,this)>10?console.log("exit"):m(k,this).presenter.ask({mainTheme:m(b,this)}).then((function(e){console.log("#idation result:",e),y(w,t,e.choices[0].message.content),v(S,t,j).call(t)})).catch((function(e){console.error(e)}))}function j(){var e=this,t=[];return m(k,this).reviewers.forEach((function(n){t.push(n.ask({mainTheme:m(b,e),currentIdea:m(w,e)}))})),Promise.allSettled(t).then((function(t){console.log("#review result:",t);var n=v(S,e,P).call(e,t);n.total<=n.agree?e.stopDiscussion():v(S,e,T).call(e)})).catch((function(e){console.error(e)}))}function P(e){var t=[],n={agree:0,opposition:0,unknown:0,total:0};return e.forEach((function(e,o){e.value.choices[0].message.content.match(/^[\s\S]*?(賛成|反対)/);var i=RegExp.$1;n.total++,"賛成"==i?(n.agree++,t.push(!0)):"反対"==i?(n.opposition++,t.push(!1)):(n.unknown++,t.push(null))})),console.log(n),n}var E,W=new(function(){return e=function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,t=S),t.add(this),h(this,b,void 0),h(this,w,void 0),h(this,g,0),h(this,d,[]),h(this,k,void 0)},(t=[{key:"init",value:function(e){var t=this;y(b,this,e.mainTheme),y(w,this,""),y(g,this,0),y(d,this,[]),y(k,this,{presenter:new c({template:e.members.presenter.template||""}),reviewers:[]}),e.members.reviewers.forEach((function(e){m(k,t).reviewers.push(new c({template:e.template||""}))}))}},{key:"startDiscussion",value:function(){v(S,this,T).call(this)}},{key:"stopDiscussion",value:function(){}}])&&f(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());$("#cont-btn-sendtest").on("click",(function(){var e=$('textarea[name="main-theme"]').val();new Promise((function(e,t){E?e(E):window.getCsrfToken((function(t){e(E=t)}))})).then((function(e){return new Promise((function(e,t){$.ajax({url:"./index_files/apis/get_committee_settings.php",type:"get",dataType:"json",async:!0}).done((function(t){e(t.members)})).fail((function(e){console.error(e)}))}))})).then((function(t){W.init({mainTheme:e,members:t}),W.startDiscussion()}))}))})();
//# sourceMappingURL=script.js.map